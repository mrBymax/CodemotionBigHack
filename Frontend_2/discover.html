<!DOCTYPE html>
<html lang="en">


<head>

    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>ST-udent Discover</title>

    <meta content="" name="description">

    <meta content="" name="keywords">

    <!-- FAVICONS -->

    <!-- CSS THIRD PART -->
    <link href="assets/bootstrap/bootstrap.min.css" rel="stylesheet">

    <!-- MAIN CSS -->
    <link href="assets/css/main.css" rel="stylesheet">

</head>

<body>
    <div class="container">

        <div class="py-5 text-center">
            <img class="d-block mx-auto mb-4" src="assets/img/logo.png" width="150" height="150">
            <h1 class="stColor">Discover</h1>
            <h4 class="titleDescription linea">Here you can analize your electronics component for discover and learn what components <a href="https://www.st.com/content/st_com/en.html" target="_blank" class="stColor">STMicroelectronics</a> produce for this object.</h4>
        </div>

        <div>
            <div>
                <div class="form-group">
                    <label for="uploadImage">Choose an image:</label>
                    <input type="file" class="form-control-file" id="uploadImage" name="uploadImage" accept="image/png, image/jpeg">
                </div>

                <button onclick="analizzaImmagine();" class="btn btn-primary mb-2 customButton">START THE ANALYSIS</button>
            </div>

            <!-- QUA VA LA RISPOSTA CHE ARRIVA DAL SERVER -->
            <div id="serverResponse">

            </div>
        </div>

        <!-- QUA VA IL CHATBOT -->
        <div>
            <h1 class="stColor">as SiT ant</h1>


        </div>

    </div>

    <footer class="container text-center">
        <p>&copy; 2021 <a href="https://www.st.com/content/st_com/en.html" target="_blank" class="stColor">STMicroelectronics</a></p>
    </footer>

    <script src="assets/jquery-3.6.0.min.js"></script>
    <script src="assets/bootstrap/bootstrap.bundle.js"></script>


    <script>
        function showDataForDevice(item) {
            let name = item.class,
                imgUrl = item.imgEndpoint,
                score = item.score;
        }

        function analizzaImmagine() {
            function getBase64(file) {
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function() {
                    fetch("http://localhost:8083/v1/classify/classifyImage", {
                            method: "POST",
                            mode: 'cors',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                image_b64: reader.result
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            let text = "Seleziona:\n";
                            for (let i in data) {
                                let item = data[i],
                                    name = item.class,
                                    imgUrl = item.imgEndpoint,
                                    score = item.score;
                                text += `${i}: ${name} - ${score}\n`
                            }
                            let chosen = prompt(text, "0");
                            showDataForDevice(data[chosen]);
                        })
                };
                reader.onerror = function(error) {
                    console.log('Error: ', error);
                };
            }

            var file = document.getElementById('uploadImage').files[0];
            getBase64(file); // prints the base64 string
        }

    </script>





</body>

</html>
